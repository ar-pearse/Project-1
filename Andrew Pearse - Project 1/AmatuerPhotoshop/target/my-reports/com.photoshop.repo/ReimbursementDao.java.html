<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReimbursementDao.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AmatuerPhotoshop</a> &gt; <a href="index.source.html" class="el_package">com.photoshop.repo</a> &gt; <span class="el_source">ReimbursementDao.java</span></div><h1>ReimbursementDao.java</h1><pre class="source lang-java linenums">package com.photoshop.repo;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.LinkedList;
import java.util.List;

import com.photoshop.model.Reimbursement;
import com.photoshop.model.ReimbursementStatus;
import com.photoshop.model.ReimbursementType;
import com.photoshop.util.ConnectionUtil;

public class ReimbursementDao implements DaoContract&lt;Reimbursement, Integer&gt; {

	private UserDao ud;
	
	public ReimbursementDao() {
<span class="fc" id="L21">		this(new UserDao());</span>
<span class="fc" id="L22">	}</span>
	
<span class="fc" id="L24">	public ReimbursementDao(UserDao ud) {</span>
<span class="fc" id="L25">		this.ud = ud;</span>
<span class="fc" id="L26">	}</span>
	
	@Override
	public List&lt;Reimbursement&gt; findAll() {
<span class="fc" id="L30">		List&lt;Reimbursement&gt; reimbursements = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L31">		String sql = &quot;select * from get_all_reimbursements&quot;;</span>
		
<span class="fc" id="L33">		try (Connection conn = ConnectionUtil.getInstance().getConnection() ){</span>
<span class="fc" id="L34">			PreparedStatement ps = conn.prepareStatement(sql);</span>
<span class="fc" id="L35">			ResultSet rs = ps.executeQuery();</span>
			
<span class="fc bfc" id="L37" title="All 2 branches covered.">			while(rs.next()) {</span>
<span class="fc" id="L38">				reimbursements.add(new Reimbursement(rs.getInt(&quot;id&quot;), rs.getFloat(&quot;amount&quot;), rs.getTimestamp(&quot;submitted&quot;), rs.getTimestamp(&quot;resolved&quot;), rs.getString(&quot;description&quot;), </span>
<span class="fc" id="L39">										ud.findById(rs.getInt(&quot;author&quot;)), ud.findById(rs.getInt(&quot;resolver&quot;)), </span>
<span class="fc" id="L40">										new ReimbursementStatus(rs.getInt(&quot;status_id&quot;), rs.getString(&quot;status&quot;)), </span>
<span class="fc" id="L41">										new ReimbursementType(rs.getInt(&quot;type_id&quot;), rs.getString(&quot;type&quot;))));</span>
			}
			
<span class="nc" id="L44">		} catch (SQLException e) {</span>
<span class="nc" id="L45">			e.printStackTrace();</span>
<span class="fc" id="L46">		}</span>
		
<span class="fc" id="L48">		return reimbursements;</span>
	}

	@Override
	public Reimbursement findById(Integer i) {
<span class="fc" id="L53">		Reimbursement reimbursement = null;</span>
<span class="fc" id="L54">		String sql = &quot;select * from get_all_reimbursements where id = ?&quot;;</span>
		
<span class="fc" id="L56">		try (Connection conn = ConnectionUtil.getInstance().getConnection()) {</span>
<span class="fc" id="L57">			PreparedStatement ps = conn.prepareStatement(sql);</span>
<span class="fc" id="L58">			ps.setInt(1, i);</span>
<span class="fc" id="L59">			ResultSet rs = ps.executeQuery();</span>
			
<span class="fc bfc" id="L61" title="All 2 branches covered.">			while(rs.next()) {</span>
<span class="fc" id="L62">				reimbursement = new Reimbursement(rs.getInt(&quot;id&quot;), rs.getFloat(&quot;amount&quot;), rs.getTimestamp(&quot;submitted&quot;), rs.getTimestamp(&quot;resolved&quot;), rs.getString(&quot;description&quot;), </span>
<span class="fc" id="L63">									ud.findById(rs.getInt(&quot;author&quot;)), ud.findById(rs.getInt(&quot;resolver&quot;)), </span>
<span class="fc" id="L64">									new ReimbursementStatus(rs.getInt(&quot;status_id&quot;), rs.getString(&quot;status&quot;)), </span>
<span class="fc" id="L65">									new ReimbursementType(rs.getInt(&quot;type_id&quot;), rs.getString(&quot;type&quot;)));</span>
			}
			
<span class="fc" id="L68">			ps.close();</span>
<span class="fc" id="L69">			rs.close();</span>
<span class="nc" id="L70">		} catch (SQLException e) {</span>
<span class="nc" id="L71">			e.printStackTrace();</span>
<span class="fc" id="L72">		}</span>
		
<span class="fc" id="L74">		return reimbursement;</span>
	}

	@Override
	public int create(Reimbursement t) {
<span class="nc" id="L79">		String sql = &quot;insert into ers_reimbursement (reimb_amount, reimb_submitted, reimb_resolved, &quot;</span>
				+ &quot;reimb_description, reimb_author, reimb_status_id, reimb_type_id) values (?,?,?,?,?,?,?)&quot;; 
<span class="nc" id="L81">		int updated = 0;</span>
<span class="nc" id="L82">		try (Connection conn = ConnectionUtil.getInstance().getConnection()){</span>
<span class="nc" id="L83">			PreparedStatement ps = conn.prepareStatement(sql);</span>
<span class="nc" id="L84">			ps.setFloat(1, t.getAmount());</span>
<span class="nc" id="L85">			ps.setTimestamp(2, Timestamp.valueOf(t.getDateSubmitted()));</span>
			
<span class="nc bnc" id="L87" title="All 2 branches missed.">			if (t.getDateResolved() != null)</span>
<span class="nc" id="L88">				ps.setTimestamp(3, Timestamp.valueOf(t.getDateResolved()));</span>
			else
<span class="nc" id="L90">				ps.setTimestamp(3, null);</span>
			
<span class="nc" id="L92">			ps.setString(4, t.getDescription());</span>
<span class="nc" id="L93">			ps.setInt(5, t.getAuthor().getId());</span>
<span class="nc" id="L94">			ps.setInt(6, t.getStatus().getId());</span>
<span class="nc" id="L95">			ps.setInt(7, t.getType().getId());</span>
			
<span class="nc" id="L97">			updated = ps.executeUpdate();</span>
			
<span class="nc" id="L99">			ps.close();</span>
<span class="nc" id="L100">		} catch (SQLException e) {</span>
<span class="nc" id="L101">			e.printStackTrace();</span>
<span class="nc" id="L102">		}</span>
		
<span class="nc" id="L104">		return updated;</span>
	}

	@Override
	public int update(Reimbursement t) {
<span class="fc" id="L109">		String sql = &quot;update ers_reimbursement set reimb_amount = ?, &quot;</span>
												+ &quot;reimb_submitted = ?, &quot;
												+ &quot;reimb_resolved = ?, &quot;
												+ &quot;reimb_description = ?,&quot;
												+ &quot;reimb_author = ?, &quot;
												+ &quot;reimb_resolver = ?, &quot;
												+ &quot;reimb_status_id = ?, &quot;
												+ &quot;reimb_type_id = ? &quot;
											 + &quot;where reimb_id = ?&quot;;
<span class="fc" id="L118">		int updated = 0;</span>
<span class="fc" id="L119">		try (Connection conn = ConnectionUtil.getInstance().getConnection()){</span>
<span class="fc" id="L120">			PreparedStatement ps = conn.prepareStatement(sql);</span>
<span class="fc" id="L121">			ps.setFloat(1, t.getAmount());</span>
<span class="fc" id="L122">			ps.setTimestamp(2, Timestamp.valueOf(t.getDateSubmitted()));</span>
			
<span class="fc bfc" id="L124" title="All 2 branches covered.">			if (t.getDateResolved() != null)</span>
<span class="fc" id="L125">				ps.setTimestamp(3, Timestamp.valueOf(t.getDateResolved()));</span>
			else
<span class="fc" id="L127">				ps.setTimestamp(3, null);</span>
			
<span class="fc" id="L129">			ps.setString(4, t.getDescription());</span>
<span class="fc" id="L130">			ps.setInt(5, t.getAuthor().getId());</span>
<span class="fc" id="L131">			ps.setInt(6, t.getResolver().getId());</span>
<span class="fc" id="L132">			ps.setInt(7, t.getStatus().getId());</span>
<span class="fc" id="L133">			ps.setInt(8, t.getType().getId());</span>
<span class="fc" id="L134">			ps.setInt(9, t.getId());</span>
			
<span class="fc" id="L136">			updated = ps.executeUpdate();</span>
		
<span class="fc" id="L138">			ps.close();</span>
<span class="nc" id="L139">		} catch (SQLException e) {</span>
<span class="nc" id="L140">			e.printStackTrace();</span>
<span class="fc" id="L141">		}</span>
		
<span class="fc" id="L143">		return updated;</span>
	}

	public List&lt;Reimbursement&gt; findAllByUser(int i) {
<span class="fc" id="L147">		List&lt;Reimbursement&gt; reimbursements = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L148">		String sql = &quot;select * from get_all_reimbursements where author = ?&quot;;</span>
		
<span class="fc" id="L150">		try (Connection conn = ConnectionUtil.getInstance().getConnection() ){</span>
<span class="fc" id="L151">			PreparedStatement ps = conn.prepareStatement(sql);</span>
<span class="fc" id="L152">			ps.setInt(1, i);</span>
<span class="fc" id="L153">			ResultSet rs = ps.executeQuery();</span>
			
<span class="fc bfc" id="L155" title="All 2 branches covered.">			while(rs.next()) {</span>
<span class="fc" id="L156">				reimbursements.add(new Reimbursement(rs.getInt(&quot;id&quot;), rs.getFloat(&quot;amount&quot;), rs.getTimestamp(&quot;submitted&quot;), rs.getTimestamp(&quot;resolved&quot;), rs.getString(&quot;description&quot;), </span>
<span class="fc" id="L157">										ud.findById(rs.getInt(&quot;author&quot;)), ud.findById(rs.getInt(&quot;resolver&quot;)), </span>
<span class="fc" id="L158">										new ReimbursementStatus(rs.getInt(&quot;status_id&quot;), rs.getString(&quot;status&quot;)), </span>
<span class="fc" id="L159">										new ReimbursementType(rs.getInt(&quot;type_id&quot;), rs.getString(&quot;type&quot;))));</span>
			}
			
			
<span class="nc" id="L163">		} catch (SQLException e) {</span>
<span class="nc" id="L164">			e.printStackTrace();</span>
<span class="fc" id="L165">		}</span>
		
<span class="fc" id="L167">		reimbursements.sort( (r1, r2) -&gt; r1.getStatus().getStatus().compareTo(r2.getStatus().getStatus()) );</span>
		
<span class="fc" id="L169">		return reimbursements;</span>
	}

	@Override
	public int delete(Integer i) {
<span class="nc" id="L174">		int updated = 0;</span>
		
<span class="nc" id="L176">		try(Connection conn = ConnectionUtil.getInstance().getConnection()){</span>
<span class="nc" id="L177">			String sql = &quot;delete from ers_reimbursement where reimb_id = ?&quot;;</span>
<span class="nc" id="L178">			PreparedStatement ps = conn.prepareStatement(sql);</span>
<span class="nc" id="L179">			ps.setInt(1, i);</span>
			
<span class="nc" id="L181">			updated = ps.executeUpdate();</span>
			
<span class="nc" id="L183">			ps.close();</span>
<span class="nc" id="L184">		} catch (SQLException e) {</span>
<span class="nc" id="L185">			e.printStackTrace();</span>
<span class="nc" id="L186">		}</span>
		
<span class="nc" id="L188">		return updated;</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>